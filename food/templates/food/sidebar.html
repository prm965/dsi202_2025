<aside class="bg-[#f7efda] w-[320px] p-6 shrink-0 h-full border-l border-gray-200">
  
  <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
  <div class="flex flex-col items-center mb-6">
    <img src="https://via.placeholder.com/80" alt="User Profile" class="rounded-full w-20 h-20 mb-3">
    <h4 class="font-medium text-lg mb-2">{{ user.username }}</h4>
    <p class="text-sm text-gray-500">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ VIP</p>
  </div>

  <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ -->
<div class="flex flex-col mb-6">

  <div class="flex items-center justify-between mb-3">
    <div class="flex items-center">
      <i class="fi fi-sr-shopping-cart text-xl mr-2"></i>
      <h3 class="text-xl font-bold">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
    </div>
    <span class="badge text-white bg-red-500 px-2 py-1 rounded-full">
      0
    </span>
  </div>

  <!-- ‚úÖ ‡∏¢‡πâ‡∏≤‡∏¢ "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤" ‡∏°‡∏≤‡∏ä‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ -->
  <div id="empty-cart-message" class="text-gray-500 mb-3">
    ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  </div>

</div>


  {% if request.session.cart %}
    {% for item_id, item in request.session.cart.items %}
      <div id="cart-item-{{ item_id }}" class="flex justify-between mb-2">
        <span>{{ item.name }} x</span>

        <form method="POST" class="flex items-center gap-2" id="cart-form-{{ item_id }}">
          {% csrf_token %}
          <button type="button" class="quantity-btn bg-gray-200 px-2 py-1 rounded-full" data-action="decrease" data-item-id="{{ item_id }}">‚àí</button>
          <input type="number" value="{{ item.quantity }}" class="w-12 text-center quantity-input" readonly />
          <button type="button" class="quantity-btn bg-gray-200 px-2 py-1 rounded-full" data-action="increase" data-item-id="{{ item_id }}">+</button>
        </form>

        <span>‡∏ø{{ item.price|floatformat:0 }}</span>
      </div>
    {% endfor %}
  {% else %}
    <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
  {% endif %}

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ -->
<div class="flex justify-center mb-4">
  <button id="clear-cart-btn" class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition">
    ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  </button>
</div>

  <!-- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
  <div class="mb-6">
    <h4 class="text-lg font-medium mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h4>
    <select class="w-full p-2 border border-gray-300 rounded-md">
      <option value="credit-card">‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</option>
      <option value="bank-transfer">‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</option>
      <option value="paypal">PayPal</option>
    </select>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ -->
  <div class="flex justify-center">
    <button class="bg-blue-600 text-white px-6 py-2 rounded-lg text-lg font-medium hover:bg-blue-700 transition">
      ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
    </button>
  </div>

  
</aside>
<script>
  // üîÑ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  const refreshCartCount = () => {
    fetch('/get-cart-count/')
      .then(response => response.json())
      .then(data => {
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Badge
        const badgeElement = document.querySelector('.badge');
        badgeElement.textContent = data.cart_count > 0 ? data.cart_count : 0;
      })
      .catch(error => console.error('Error:', error));
  };

  // üõí ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Document ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  document.addEventListener('DOMContentLoaded', () => {
    // üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å Session ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    refreshCartCount();

    // üõ†Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    document.querySelectorAll('.quantity-btn').forEach(button => {
      button.addEventListener('click', function(event) {
        event.preventDefault();

        const action = this.getAttribute('data-action');
        const itemId = this.getAttribute('data-item-id');
        const form = document.getElementById(`cart-form-${itemId}`);

        // üîÑ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏õ‡∏ó‡∏µ‡πà Server
        fetch(`/update-cart/${itemId}/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': form.querySelector('[name="csrfmiddlewaretoken"]').value
          },
          body: new URLSearchParams({ action: action })
        })
        .then(response => response.json())
        .then(data => {
          if (data.should_remove) {
            // üóëÔ∏è ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á Popup
            const confirmRemove = confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö ${data.item_name} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤?`);
            if (confirmRemove) {
              fetch(`/remove-from-cart/${itemId}/`, {
                method: 'POST',
                headers: {
                  'X-CSRFToken': form.querySelector('[name="csrfmiddlewaretoken"]').value
                }
              })
              .then(() => {
                document.getElementById(`cart-item-${itemId}`).remove(); // üî• ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å DOM
                refreshCartCount(); // üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
              })
              .catch(error => console.error('Error:', error));
            } else {
              form.querySelector('.quantity-input').value = 1; // üîÑ ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô 1
            }
          } else {
            // üîÑ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
            form.querySelector('.quantity-input').value = data.item_quantity;
            refreshCartCount(); // üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
          }
        })
        .catch(error => console.error('Error:', error));
      });
    });
  });

    document.addEventListener('DOMContentLoaded', () => {
    const clearCartBtn = document.getElementById('clear-cart-btn');

    // üìå ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
    clearCartBtn.addEventListener('click', () => {
      if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤?")) {
        fetch('/clear-cart/', {
          method: 'POST',
          headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.message === 'Cart cleared') {
            // üî• ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤
            document.querySelectorAll("[id^='cart-item-']").forEach(item => item.remove());
            // üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô Badge
            document.querySelector('.badge').textContent = 0;
            // üîÑ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            const cartContainer = document.querySelector('.flex.flex-col.mb-6');
            cartContainer.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>';
          }
        })
        .catch(error => console.error('Error:', error));
      }
    });
  });

  document.getElementById('clear-cart').addEventListener('click', function(event) {
    event.preventDefault();
    fetch('/clear-cart/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name="csrfmiddlewaretoken"]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        document.querySelector('.badge').textContent = '0';
        document.querySelector('#cart-items').innerHTML = '';
        document.querySelector('#empty-cart-message').style.display = 'block'; // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    })
    .catch(error => console.error('Error:', error));
});

</script>
